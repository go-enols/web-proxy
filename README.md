# Proxy

## 重构概述

原本的单文件 `main.go` 已经被重构为多个模块化的文件，提高了代码的可维护性和可读性。

## 文件结构

```
web-proxy/
├── main.go          # 程序入口点
├── config.go        # 配置管理模块
├── auth.go          # 认证模块
├── proxy.go         # 代理处理模块
├── server.go        # 服务器模块
├── utils.go         # 工具函数模块
├── go.mod           # Go模块文件
├── build.cmd        # 构建脚本
└── build/           # 构建输出目录
```

## 模块说明

### main.go
- 程序的入口点
- 负责初始化配置和启动服务器
- 代码简洁，职责单一

### config.go
- 配置结构体定义
- 命令行参数解析
- 代理URL解析功能
- 全局配置管理

### auth.go
- 客户端认证验证
- Basic认证处理
- 认证失败响应处理

### proxy.go
- HTTP/HTTPS代理处理逻辑
- 二次代理转发功能
- 直接转发功能
- 连接隧道处理

### server.go
- HTTP服务器启动和管理
- 路由处理
- 服务器配置

### utils.go
- 数据转发工具函数
- 请求日志记录
- 通用工具函数

## 重构优势

1. **模块化设计**: 每个文件负责特定的功能，职责清晰
2. **易于维护**: 修改某个功能时只需要关注对应的模块
3. **代码复用**: 工具函数可以在多个模块间复用
4. **测试友好**: 每个模块可以独立进行单元测试
5. **可扩展性**: 新功能可以轻松添加到对应模块或创建新模块

## 使用方法

重构后的使用方法与原版本完全相同：

```bash
# 编译
go build -o web-proxy.exe

# 运行
./web-proxy.exe -proxy-port 9522 -direct-port 9521 -proxy-url "user:pass@proxy.example.com:8080" -user "myuser" -pwd "mypass"
```

## 兼容性

- 完全向后兼容原版本的所有功能
- 命令行参数保持不变
- API接口保持不变
- 配置文件格式保持不变